unit Cadastro.Fornecedor;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Cadastro.Cliente, FireDAC.Stan.Intf,
  FireDAC.Stan.Option, FireDAC.Stan.Param, FireDAC.Stan.Error, FireDAC.DatS,
  FireDAC.Phys.Intf, FireDAC.DApt.Intf, FireDAC.Stan.Async, FireDAC.DApt,
  Data.DB, FireDAC.Comp.DataSet, FireDAC.Comp.Client, Vcl.StdCtrls, Vcl.Buttons,
  Vcl.Mask, Vcl.ExtCtrls, Vcl.DBCtrls;

type
  TfrmCadastroFornecedor = class(TfrmCadastroCliente)
    procedure btnNovoClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmCadastroFornecedor: TfrmCadastroFornecedor;

implementation

{$R *.dfm}

procedure TfrmCadastroFornecedor.btnNovoClick(Sender: TObject);
var
  NovoCodigo: Integer;
  QueryTemp: TFDQuery;
begin
  if not sqlPadrao.Active then
    sqlPadrao.Open;

  // Criar um TFDQuery temporário para buscar o próximo código
  QueryTemp := TFDQuery.Create(nil);
  try
    QueryTemp.Connection := sqlPadrao.Connection; // Usa a mesma conexão do sqlPadrao
    QueryTemp.SQL.Text := 'SELECT GEN_ID(GEN_FORNECEDOR, 1) FROM RDB$DATABASE';
    QueryTemp.Open;
    NovoCodigo := QueryTemp.Fields[0].AsInteger;
    QueryTemp.Close;
  finally
    QueryTemp.Free;
  end;

  // Inicia a inserção e define o novo código gerado
  sqlPadrao.Append;
  sqlPadrao.FieldByName('CODIGO').AsInteger := NovoCodigo;

  btnNovo.Enabled := False;
  btnSalvar.Enabled := True;
  btnCancelar.Enabled := True;
  edtNome.Enabled := True;
end;

end.
